Wgandalf python bindings
========================


1. Compiling Python bindings

Python module is not compiled by default. ./configure --with-python
enables the compilation (provided that the configure script is
able to locate the Python.h file in the system. If not, it is
assumed that Python is not properly installed and wgandalf will be
compiled without Python bindings).

When building manually, use the separate scripts in Python directory.
Check that the Python path in compile.sh (compile.bat for Windows)
matches your system.


2. Attaching and deleting a database

FUNCTIONS
    attach_database(shmname='', size=0)
        Connect to a shared memory database. If the database with the
        given name does not exist, it is created.
    
    delete_database(shmname)
        Delete a shared memory database.

attach_database() allows keyword arguments. If either database name
or size are omitted, default values are used. Note that the shared memory
name is expected to be converted by strtol().

Examples:

>>> a=wgdb.attach_database()
>>> b=wgdb.attach_database("1001")
>>> c=wgdb.attach_database(size=30000)
>>> d=wgdb.attach_database(size=0, shmname="9999")

delete_database() takes a single argument. If this is omitted, the
default value will be used.

>>> wgdb.delete_database("1001")
>>> wgdb.delete_database()


3. Exception handling.

wgdb module defines a wgdb.error exception object that can be used in
error handling:

>>> try:
...  a=wgdb.attach_database()
... except wgdb.error, msg:
...  print 'wgdb error'
... except:
...  print 'other error'
... 


4. Creating and manipulating records

FUNCTIONS
    create_record(db, length)
        Create a record with given length.
    
    get_first_record(db)
        Fetch first record from database.
    
    get_next_record(db, rec)
        Fetch next record from database.
    
    get_record_len(db, rec)
        Get record length (number of fields).

db is an object returned by wgdb.attach_database(). rec is an object returned
by get_first_record() or other similar functions that return a record.

Examples:

>>> d=wgdb.attach_database()
...
>>> a=wgdb.create_record(d,5)
>>> a
<WGandalf db record at b6908df8>
>>> b=wgdb.create_record(d,3)
>>> b
<WGandalf db record at b6908e10>
>>> rec=wgdb.get_first_record(d)
>>> wgdb.get_record_len(d,rec)
5
>>> rec
<WGandalf db record at b6908df8>
>>> rec=wgdb.get_next_record(d,rec)
>>> wgdb.get_record_len(d,rec)
3
>>> rec
<WGandalf db record at b6908e10>
>>> rec=wgdb.get_next_record(d,rec)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
wgdb.error: Failed to fetch a record.


5. Writing and reading field contents.

From wgdb module:

/* We use higher level (encoding is done by wgdb lib) functions to
 * write data. Since similar API is not present for reading records,
 * decoding is done by this module. We provide only one function for
 * reading data: the concept behind that is that the side which holds
 * the data, also knows it's type. So when writing, we know the type
 * in Python, and so decide the function to use _on Python side_ of
 * the fence. When reading, the type is known to the wgdb module, so
 * we decide on the function internally and return the data _in the
 * format known to Python_.
 */

FUNCTIONS
    get_decoded_field(db, rec, fieldnr)
        Get field data decoded to corresponding Python type.
    
    set_double_field(db, rec, fieldnr, data)
        Set double precision field value.
    
    set_int_field(db, rec, fieldnr, data)
        Set integer field value.
    
    set_null_field(db, rec, fieldnr)
        Set NULL (empty) field value.
    
    set_str_field(db, rec, fieldnr, data)
        Set string field value.

db is an object returned by wgdb.attach_database(). rec is an object returned
by get_first_record() or other similar functions that return a record.

Examples:

>>> d=wgdb.attach_database()
...
>>> tmp=wgdb.create_record(d,4)
>>> tmp
<WGandalf db record at b6985df8>
>>> print (wgdb.get_decoded_field(d,tmp,0),)
(None,)
>>> wgdb.set_int_field(d,tmp,0,0)
>>> wgdb.set_int_field(d,tmp,1,899)
>>> wgdb.set_double_field(d,tmp,2,332.33444)
>>> wgdb.set_str_field(d,tmp,3,"hello")
>>> print (wgdb.get_decoded_field(d,tmp,0),)
(0,)
>>> print (wgdb.get_decoded_field(d,tmp,1),)
(899,)
>>> print (wgdb.get_decoded_field(d,tmp,2),)
(332.33443999999997,)
>>> print (wgdb.get_decoded_field(d,tmp,3),)
('hello',)
>>> wgdb.set_null_field(d,tmp,3)
>>> print (wgdb.get_decoded_field(d,tmp,3),)
(None,)

